if (map[pacman.y][pacman.x] === '.' || map[pacman.y][pacman.x] === 'o') {
    score++;
    pelletSound.play();
    map[pacman.y] = map[pacman.y].substring(0, pacman.x) + ' ' + map[pacman.y].substring(pacman.x + 1);
    scoreElement.textContent = score;
  }

  ghosts.forEach(g => {
    if (g.x === pacman.x && g.y === pacman.y) {
      clearInterval(gameInterval);
      deathSound.play();
      alert('Game Over!');
    }
  });

  drawMap();
  drawPacman();
  drawGhosts();
}

document.addEventListener('keydown', e => {
  if (e.key === 'ArrowUp') pacman.nextDir = { x: 0, y: -1 };
  if (e.key === 'ArrowDown') pacman.nextDir = { x: 0, y: 1 };
  if (e.key === 'ArrowLeft') pacman.nextDir = { x: -1, y: 0 };
  if (e.key === 'ArrowRight') pacman.nextDir = { x: 1, y: 0 };
});

gameInterval = setInterval(update, 150);

  </script>
</body>
</html>
